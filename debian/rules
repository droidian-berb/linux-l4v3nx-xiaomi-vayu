#!/usr/bin/make -f

include /usr/share/linux-packaging-snippets/kernel-snippet.mk

%:
	dh $@

debian/control:
	## Customization like kernel developer in kernel name
	cat /buildd/sources/debian/control.in > /usr/share/linux-packaging-snippets/control.in;
	# Override to enable aarch64 host compat
	# Remove python prebuilt from control.in for aarch64 compat
	# Requires a custom path-override-prepare:
	@HOST_ARCH=$$(uname -m); \
	if [ "$$HOST_ARCH" = "aarch64" ]; then \
		sed -i '/android-platform-prebuilts-python-linux-x86-2.7.5,/d' /usr/share/linux-packaging-snippets/control.in; \
	fi
	# Droidian var substitutions
	sed -e "s|@KERNEL_BASE_VERSION@|$(KERNEL_BASE_VERSION)|g" \
		-e "s|@VARIANT@|$(VARIANT)|g" \
		-e "s|@KERNEL_DEVELOPER@|$(KERNEL_DEVELOPER)|g" \
		-e "s|@DEVICE_VENDOR@|$(DEVICE_VENDOR)|g" \
		-e "s|@DEVICE_MODEL@|$(DEVICE_MODEL)|g" \
		-e "s|@DEVICE_FULL_NAME@|$(DEVICE_FULL_NAME)|g" \
		-e "s|@DEB_TOOLCHAIN@|$(DEB_TOOLCHAIN)|g" \
		-e "s|@DEB_BUILD_ON@|$(DEB_BUILD_ON)|g" \
		-e "s|@DEB_BUILD_FOR@|$(DEB_BUILD_FOR)|g" \
		/usr/share/linux-packaging-snippets/control.in > debian/control

path-override-prepare:
	# Override to adapt aarch64 host compat.
	# Requires removing x86_64 python prebuilt from control
	mkdir -p debian/path-override
	ln -sf /usr/bin/python debian/path-override/python
	ln -sf /usr/bin/python debian/path-override/python2
	ln -sf /usr/bin/python debian/path-override/python2.7
